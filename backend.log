INFO:     Will watch for changes in these directories: ['/home/szh/projects/RuralBrain']
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
INFO:     Started reloader process [22947] using WatchFiles
============================================================
RuralBrain 后端服务启动中...
============================================================
INFO:     Started server process [22949]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
INFO:     127.0.0.1:35698 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:52762 - "GET /health HTTP/1.1" 200 OK
INFO:service.server:指定模式: planning
INFO:service.server:转发到 Planning Service [thread_id=e41c42ee-8b00-42f6-ab54-af8c0db4a3ad, work_mode=fast]: 博罗古城的规划目标是什么？
INFO:     127.0.0.1:52772 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8003/api/v1/chat/planning "HTTP/1.1 200 OK"
INFO:service.server:指定模式: detection
INFO:service.server:调用图像检测 Agent [thread_id=173a8348-9a5f-42bc-b602-a739f54fca73]: 你好, 图片数量: 0
INFO:     127.0.0.1:33620 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
WARNING:  WatchFiles detected changes in 'references/agent_skills/skills/project-development/scripts/pipeline_template.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/optimizer.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/cli.py', 'references/agent_skills/skills/evaluation/scripts/evaluator.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/__init__.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/skill_generator.py', 'references/agent_skills/examples/digital-brain-skill/agents/scripts/weekly_review.py', 'references/agent_skills/examples/interleaved_thinking/tests/test_models.py', 'references/agent_skills/examples/digital-brain-skill/agents/scripts/content_ideas.py', 'references/agent_skills/skills/context-degradation/scripts/degradation_detector.py', 'references/agent_skills/examples/interleaved_thinking/examples/01_basic_capture.py', 'references/agent_skills/skills/hosted-agents/scripts/sandbox_manager.py', 'references/agent_skills/examples/interleaved_thinking/examples/03_full_optimization.py', 'references/agent_skills/examples/book-sft-pipeline/scripts/pipeline_example.py', 'references/agent_skills/skills/context-compression/scripts/compression_evaluator.py', 'references/agent_skills/skills/advanced-evaluation/scripts/evaluation_example.py', 'references/agent_skills/skills/context-fundamentals/scripts/context_manager.py', 'references/agent_skills/examples/interleaved_thinking/tests/__init__.py', 'references/agent_skills/skills/tool-design/scripts/description_generator.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/loop.py', 'references/agent_skills/skills/filesystem-context/scripts/filesystem_context.py', 'references/agent_skills/skills/memory-systems/scripts/memory_store.py', 'references/agent_skills/skills/multi-agent-patterns/scripts/coordination.py', 'references/agent_skills/examples/digital-brain-skill/agents/scripts/idea_to_draft.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/analyzer.py', 'references/agent_skills/examples/interleaved_thinking/examples/02_tool_usage.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/capture.py', 'references/agent_skills/examples/digital-brain-skill/agents/scripts/stale_contacts.py', 'references/agent_skills/examples/interleaved_thinking/reasoning_trace_optimizer/models.py', 'references/agent_skills/skills/context-optimization/scripts/compaction.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [22949]
INFO:     Started server process [25986]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [25986]
INFO:     Started server process [26319]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [26319]
INFO:     Started server process [27997]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [27997]
INFO:     Started server process [2555]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2555]
INFO:     Started server process [7414]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [7414]
INFO:     Started server process [14558]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [14558]
INFO:     Started server process [24524]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'frontend/my-app/node_modules/flatted/python/flatted.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [24524]
INFO:     Started server process [16302]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
INFO:service.server:指定模式: detection
INFO:service.server:调用图像检测 Agent [thread_id=thread_1768656949860]: 博罗县的农业发展布局是怎样的？, 图片数量: 0
INFO:     127.0.0.1:33076 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:service.server:对话完成 [thread_id=thread_1768656949860]
INFO:service.server:指定模式: detection
INFO:service.server:调用图像检测 Agent [thread_id=thread_1768656949860]: 你能多轮对话吗，知识库来源在哪, 图片数量: 0
INFO:     127.0.0.1:33824 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:service.server:对话完成 [thread_id=thread_1768656949860]
INFO:service.server:指定模式: planning
INFO:service.server:转发到 Planning Service [thread_id=b6572f70-2ff8-47b9-9a2a-74b96f33cf48, work_mode=fast]: 博罗县农业布局
INFO:     127.0.0.1:58986 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8003/api/v1/chat/planning "HTTP/1.1 200 OK"
INFO:     127.0.0.1:58004 - "GET /health HTTP/1.1" 200 OK
INFO:service.server:指定模式: planning
INFO:service.server:转发到 Planning Service [thread_id=dd19e97a-161e-44aa-b5dc-b0dfac4eb3e4, work_mode=fast]: 博罗县农业
INFO:     127.0.0.1:46412 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST http://localhost:8003/api/v1/chat/planning "HTTP/1.1 200 OK"
WARNING:  WatchFiles detected changes in 'src/rag/service/api/routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [16302]
INFO:     Started server process [6912]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/agents/planning_agent.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [6912]
INFO:     Started server process [11247]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
INFO:service.server:指定模式: detection
INFO:service.server:调用图像检测 Agent [thread_id=thread_1768657924321]: 博罗县的农业发展布局是怎样的？, 图片数量: 0
INFO:     127.0.0.1:34018 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:service.server:对话完成 [thread_id=thread_1768657924321]
INFO:service.server:指定模式: detection
INFO:service.server:调用图像检测 Agent [thread_id=thread_1768657924321]: 你刚才的回答参考了知识库中的哪些部分？, 图片数量: 0
INFO:     127.0.0.1:34770 - "POST /chat/stream HTTP/1.1" 200 OK
INFO:httpx:HTTP Request: POST https://api.deepseek.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:service.server:对话完成 [thread_id=thread_1768657924321]
WARNING:  WatchFiles detected changes in 'src/agents/planning_agent.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [11247]
INFO:     Started server process [15366]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/agents/planning_agent.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [15366]
INFO:     Started server process [15561]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/core/tools.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [15561]
INFO:     Started server process [22716]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/agents/planning_agent.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [22716]
INFO:     Started server process [23541]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/core/cache.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [23541]
INFO:     Started server process [25213]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/core/tools.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [25213]
INFO:     Started server process [25402]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/tests/test_optimization.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [25402]
INFO:     Started server process [26527]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/tests/test_optimization.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [26527]
INFO:     Started server process [28129]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/tests/test_optimization_simple.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [28129]
INFO:     Started server process [29135]
INFO:     Waiting for application startup.
INFO:service.server:RuralBrain 服务启动中...
INFO:service.server:正在加载 AI 模型...
INFO:service.server:AI 模型加载完成
INFO:service.server:RuralBrain 服务启动完成
INFO:     Application startup complete.
