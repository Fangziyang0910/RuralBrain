# 知识库数据处理指南

## 📁 目录结构

知识库数据应按以下结构组织：

```
src/data/
├── 政策/               # 政策文件目录
│   ├── 国家政策.md
│   ├── 省级政策.txt
│   └── 地方政策.pptx
└── 案例/               # 案例文件目录
    ├── 成功案例.md
    ├── 典型案例.txt
    └── 示范案例.pptx
```

## 📝 推荐格式

### 1. Markdown 格式（强烈推荐）

**优势:**
- ✅ 保留文档结构（标题层级）
- ✅ 支持代码块、表格、列表
- ✅ 易于编辑和维护
- ✅ 检索时保持上下文完整性
- ✅ 支持按标题分割，切片更合理

**示例文件结构:**

```markdown
# 博罗县乡村振兴政策

## 一、总体目标

到 2025 年，实现...

### 1.1 产业振兴
- 发展特色农业
- 建设现代农业园区

### 1.2 人才振兴
- 培育新型职业农民
- 引进专业人才

## 二、重点任务

### 2.1 基础设施建设
...

## 三、保障措施

### 3.1 政策支持
...

### 3.2 资金投入
...
```

**格式建议:**
- 使用 `#` 作为主标题（文档标题）
- 使用 `##` 作为一级标题（章节）
- 使用 `###` 作为二级标题（小节）
- 使用 `-` 作为无序列表
- 使用数字列表 `1.` `2.` `3.` 表示步骤
- 使用 `**粗体**` 强调重点
- 代码块使用三个反引号 ``` 包围

### 2. TXT 格式（备选）

**适用场景:**
- 简单文本内容
- 从其他系统导出的纯文本
- 不需要格式化的文档

**建议:**
- 使用空行分隔段落
- 使用编号组织内容
- 避免过长的段落（建议 200-500 字）

### 3. PPTX 格式（不推荐）

**适用场景:**
- 现有的演示文稿
- 必须保留原有格式

**缺点:**
- ❌ 结构化信息较少
- ❌ 切片质量可能不佳
- ❌ 可能包含无关内容（页码、占位符等）

**建议:** 尽可能转换为 Markdown 格式

## 📋 内容组织建议

### 政策文件

**命名规范:**
- 使用清晰的文件名
- 包含发布机构、时间、主题
- 示例：`2024-广东省乡村振兴政策.md`

**内容结构:**
```markdown
# [标题]

发布机构: xxx
发布时间: 2024-01-01
政策类型: xxx

## 背景
（政策出台的背景和目的）

## 主要内容
### 1. 总体要求
### 2. 重点任务
### 3. 保障措施

## 实施细则
（具体的实施步骤和要求）

## 附则
（其他相关说明）
```

### 案例文件

**命名规范:**
- 包含地区、主题
- 示例：`博罗县-智慧农业案例.md`

**内容结构:**
```markdown
# [案例标题]

地区: xxx
时间: 2023-2024
类型: 成功案例/典型案例/示范案例

## 背景介绍
（案例的背景和问题）

## 实施方案
### 1. 总体思路
### 2. 具体措施
### 3. 技术方案

## 实施效果
### 1. 量化指标
### 2. 质性描述

## 经验总结
（可复制的经验和做法）

## 相关政策
（引用的相关政策文件）
```

## 🔄 文档转换方法

### 从 Word 转换为 Markdown

**方法 1: 使用 Pandoc**
```bash
# 安装 Pandoc
sudo apt install pandoc

# 转换文档
pandoc input.docx -o output.md
```

**方法 2: 使用在线工具**
- https://word2md.com/
- https://cloudconvert.com/docx-to-md

**方法 3: 手动转换**
1. 在 Word 中打开文档
2. 复制内容到 Typora、Obsidian 等 Markdown 编辑器
3. 调整格式后保存为 .md 文件

### 从 PDF 转换为 Markdown

**方法 1: 使用 pdf2md**
```bash
pip install pdf2md
pdf2md input.pdf > output.md
```

**方法 2: 使用在线工具**
- https://pdf2md-online.com/
- https://cloudconvert.com/pdf-to-md

**注意:** PDF 转换可能需要手动调整格式

### 从 PPT 转换为 Markdown

**方法 1: 手动转换**
1. 打开 PPT 文件
2. 将每页内容复制到 Markdown
3. 使用标题层级组织内容

**方法 2: 导出为 PDF 后转换**
1. PPT -> 导出 PDF
2. PDF -> 使用工具转换为 Markdown

## 🚀 使用流程

### 1. 准备数据

```bash
# 进入数据目录
cd src/data

# 创建文件（以政策为例）
cd 政策
vim 2024-博罗县农业政策.md
```

### 2. 编辑内容

按照推荐的 Markdown 格式编辑内容。

### 3. 构建知识库

```bash
# 在项目根目录执行
python src/rag/build.py
```

### 4. 验证效果

```bash
# 测试检索
python src/rag/tool.py
```

## ⚙️ 配置说明

### 切片参数

在 `src/rag/config.py` 中配置：

```python
# 切片大小（默认 2500，适合 Planning Agent）
CHUNK_SIZE = 2500

# 切片重叠（默认 500）
CHUNK_OVERLAP = 500

# 检索返回数量（默认 5）
DEFAULT_TOP_K = 5
```

**调整建议:**
- 政策文件：建议 `CHUNK_SIZE = 3000`（保留完整政策段落）
- 案例文件：建议 `CHUNK_SIZE = 2000`（更细粒度的检索）

### 元数据过滤

检索时可以按类别过滤：

```python
# 只检索政策类文档
results = retrieve_with_metadata(
    query="农业补贴政策",
    source_filter="政策",  # 按类别过滤
    top_k=5
)

# 只检索案例类文档
results = retrieve_with_metadata(
    query="智慧农业",
    source_filter="案例",
    top_k=5
)
```

## 📊 质量检查

### 检查切片质量

构建知识库后，查看切片分析报告：

```bash
# 查看分析报告
cat knowledge_base/chroma_db/slices_analysis.json
```

### 常见问题

**问题 1: 切片过短**
- **原因:** 段落或章节内容太少
- **解决:** 合并相关内容，或减少标题层级

**问题 2: 切片过长**
- **原因:** 缺少标题分割
- **解决:** 添加子标题，使用 `##` 或 `###` 分段

**问题 3: 重复内容**
- **原因:** 多个文档包含相同内容
- **解决:** 去重或合并相似文档

**问题 4: 包含无关信息**
- **原因:** 文档包含页眉页脚、模板文字
- **解决:** 清理原文，或调整加载器过滤规则

## 💡 最佳实践

### 1. 文档命名

✅ **推荐:**
- `2024-广东省乡村振兴政策.md`
- `博罗县-智慧农业-典型案例.md`

❌ **不推荐:**
- `文档1.md`
- `新建文档.txt`
- `temp.md`

### 2. 内容组织

✅ **推荐:**
- 使用标题层级组织内容
- 每个主题独立成节
- 使用列表和表格提高可读性

❌ **不推荐:**
- 大段连续文本
- 缺少标题和结构
- 内容混乱无序

### 3. 文件大小

✅ **推荐:**
- 单个文件 5000-20000 字
- 按主题拆分成多个文件

❌ **不推荐:**
- 单个文件过大（>50000 字）
- 所有内容放在一个文件

### 4. 更新频率

- 定期更新知识库内容
- 删除过时文件
- 添加新的政策和案例

## 📞 技术支持

如有问题，请查看：
- RAG 模块文档: `src/rag/README.md`
- 测试报告: `src/rag/test_report.md`
- 项目配置: `src/rag/config.py`
