# RuralBrain 测试用例文档

## 📋 测试环境准备

### 前置条件

1. **服务启动**：按照《系统介绍文档》中的"服务启动指南"启动所有服务
2. **网络访问**：确保能访问 http://localhost:3000
3. **测试材料**：准备 `temp_test_images/` 文件夹中的测试图片

### 服务状态检查

启动服务后，访问以下地址确认服务正常：
- 前端：http://localhost:3000
- 主服务：http://localhost:8081/health
- 规划咨询：http://localhost:8003/docs
- 害虫检测：http://localhost:8000/docs

## 🖼️ 图像检测测试用例

### 测试用例 1：害虫检测

**测试目标**：验证系统识别农业害虫的能力

**测试步骤**：

1. 访问前端界面：http://localhost:3000
2. 点击"上传图片"按钮
3. 从 `temp_test_images/` 文件夹选择害虫测试图片（如稻飞虱、蚜虫等）
4. 在输入框输入测试问题："这张图片里的害虫是什么？如何防治？"
5. 点击发送按钮
6. 观察系统响应

**预期结果**：

```
✅ 系统识别过程：
1. 显示"正在调用害虫检测工具..."
2. 返回检测结果：
   - 害虫名称：稻飞虱（或其他害虫）
   - 置信度：> 0.85
   - 检测框位置：准确标注害虫位置
3. 显示标注后的图片
4. 提供防治建议：
   - 生物防治方法
   - 化学防治推荐
   - 预防措施
```

**成功标准**：
- [ ] 正确识别害虫种类
- [ ] 置信度 > 85%
- [ ] 提供专业的防治建议
- [ ] 响应时间 < 5秒

**测试图片建议**：
- 稻飞虱图片（水稻常见害虫）
- 蚜虫图片（蔬菜常见害虫）
- 棉铃虫图片（经济作物害虫）

**可能的问题和解决方案**：

| 问题 | 可能原因 | 解决方案 |
|------|---------|---------|
| 无法识别害虫 | 模型未加载 | 检查害虫检测服务是否正常运行 |
| 识别错误 | 图片质量差 | 使用清晰度更高的图片 |
| 响应慢 | 服务负载高 | 稍后重试或检查服务器资源 |

---

### 测试用例 2：大米品种识别

**测试目标**：验证系统识别大米品种和品质的能力

**测试步骤**：

1. 在前端界面点击"清除图片"（如果之前有图片）
2. 上传大米测试图片（从 `temp_test_images/` 选择）
3. 输入测试问题："这是什么品种的大米？品质如何？"
4. 点击发送
5. 观察系统响应

**预期结果**：

```
✅ 系统识别过程：
1. 显示"正在调用大米识别工具..."
2. 返回识别结果：
   - 品种名称：如"东北大米"、"泰国香米"等
   - 品质等级：如"特级"、"一级"等
   - 特征描述：颗粒大小、透明度、完整度等
3. 提供烹饪建议
4. 营养价值说明
```

**成功标准**：
- [ ] 正确识别大米品种
- [ ] 品质评估合理
- [ ] 提供相关建议
- [ ] 响应时间 < 3秒

**测试图片建议**：
- 东北大米图片
- 南方大米图片
- 糙米图片
- 糯米图片

**注意**：
- 如果大米识别服务尚未完全实现，系统可能返回服务不可用提示
- 建议使用纯色背景、光照均匀的图片

---

### 测试用例 3：牛只检测

**测试目标**：验证系统检测牛只并统计数量的能力

**测试步骤**：

1. 清除之前的图片和对话
2. 上传牛只测试图片（从 `temp_test_images/` 选择）
3. 输入测试问题："图片里有几头牛？它们在做什么？"
4. 点击发送
5. 观察系统响应

**预期结果**：

```
✅ 系统检测过程：
1. 显示"正在调用奶牛检测工具..."
2. 返回检测结果：
   - 检测到的牛只数量：准确计数
   - 每头牛的位置坐标和置信度
   - 显示带标注框的结果图片
3. 行为分析（如支持）：
   - 站立/躺卧状态
   - 健康状况初步判断
4. 养殖建议
```

**成功标准**：
- [ ] 准确统计牛只数量
- [ ] 每头牛的置信度 > 80%
- [ ] 标注框位置准确
- [ ] 响应时间 < 5秒

**测试图片建议**：
- 单头牛的图片
- 牛群图片（3-5头）
- 不同姿态的牛（站立、躺卧）
- 不同品种的牛（荷斯坦、娟姗等）

**场景测试**：
- **场景1**：单只牛，清晰正面
- **场景2**：多只牛，部分遮挡
- **场景3**：牛群，远景拍摄

---

### 测试用例 4：混合场景测试

**测试目标**：验证系统处理多图片、多检测场景的能力

**测试步骤**：

1. 同时上传多张不同类型的测试图片（害虫+大米+牛只）
2. 输入测试问题："请分析这些图片，分别给出识别结果和建议"
3. 点击发送
4. 观察系统如何处理

**预期结果**：

```
✅ 系统处理过程：
1. 智能判断需要调用多个检测工具
2. 依次处理每张图片：
   - 图片1：害虫检测 → 识别结果和建议
   - 图片2：大米识别 → 品种和品质
   - 图片3：牛只检测 → 数量和状态
3. 综合所有结果，给出统一回复
4. 每个结果都清晰标注来源图片
```

**成功标准**：
- [ ] 正确识别每张图片的类型
- [ ] 调用对应的检测工具
- [ ] 所有结果都准确返回
- [ ] 总响应时间 < 15秒

**高级测试**：
- 上传同一类型的多张图片（如3张不同的害虫图片）
- 测试系统的并发处理能力

---

## 💬 规划咨询测试用例

### 测试用例 5：乡村旅游规划咨询

**测试目标**：验证系统基于知识库提供乡村发展规划建议的能力

**测试步骤**：

1. 确保没有上传图片（或清除已有图片）
2. 在输入框输入问题：
   ```
   博罗县如何发展乡村旅游产业？有哪些具体的建议？
   ```
3. 点击发送
4. 观察系统响应过程

**预期结果**：

```
✅ 系统处理过程：
1. 显示"正在查询知识库..."
2. 工具调用过程：
   - [工具] list_documents：列出可用文档
   - [工具] search_knowledge：搜索"乡村旅游"相关内容
   - [工具] get_document_overview：获取相关文档概览
   - [工具] get_chapter_content：提取具体章节内容
3. 综合回答：
   - 引用博罗县、罗浮山、长宁镇等文档内容
   - 提供具体的旅游发展策略
   - 给出实施建议和注意事项
4. 显示来源文档信息
```

**预期回答要点**：
- [ ] 提到当地特色资源（如罗浮山文化）
- [ ] 提供产业发展策略
- [ ] 引用政策支持信息
- [ ] 给出具体实施建议
- [ ] 明确标注信息来源

**追问测试**（多轮对话）：
```
用户：刚才提到的罗浮山文化开发具体怎么做？
系统：[应该基于对话上下文，深入查询罗浮山相关文档]
```

**成功标准**：
- [ ] 回答基于知识库内容，非编造
- [ ] 引用正确的文档来源
- [ ] 建议具有可操作性
- [ ] 支持多轮追问
- [ ] 响应时间 < 10秒

---

### 测试用例 6：病虫害防治咨询

**测试目标**：验证系统提供病虫害综合防治方案的能力

**测试步骤**：

1. 输入问题：
   ```
   水稻稻飞虱如何综合防治？有哪些生物防治方法？
   ```
2. 点击发送
3. 观察系统响应

**预期结果**：

```
✅ 系统处理过程：
1. 智能判断：这是病虫害防治咨询 → 使用规划咨询模式
2. 工具调用：
   - [工具] search_key_points：搜索"稻飞虱"关键要点
   - [工具] search_knowledge：全文检索防治方案
   - [工具] get_chapter_content：获取详细技术章节
3. 综合回答：
   - 稻飞虱的危害和识别
   - 生物防治方法（如天敌、生物农药）
   - 物理防治方法（如灯光诱杀）
   - 化学防治建议（农药选择和使用时机）
   - 综合防治策略（IPM）
4. 引用技术文档来源
```

**回答质量检查**：
- [ ] 提供多种防治方法
- [ ] 强调绿色环保优先
- [ ] 给出具体操作步骤
- [ ] 提醒注意事项（如抗药性问题）
- [ ] 引用专业文档

**对比测试**：
```
场景1：仅文本提问 → "如何防治稻飞虱？"
场景2：图片+文本提问 → 上传稻飞虱图片 + "这种害虫怎么防治？"
```

**预期差异**：
- 场景1：纯知识库查询，提供通用方案
- 场景2：先识别害虫，再提供针对性防治方案

---

### 测试用例 7：政策咨询

**测试目标**：验证系统查询和解读农业政策的能力

**测试步骤**：

1. 输入问题：
   ```
   乡村振兴项目有哪些支持政策？如何申请？
   ```
2. 点击发送
3. 观察系统响应

**预期结果**：

```
✅ 系统处理过程：
1. 工具调用：
   - [工具] search_knowledge：搜索"乡村振兴"、"支持政策"
   - [工具] get_document_overview：获取政策文档概览
   - [工具] get_chapter_content：提取申请流程章节
2. 综合回答：
   - 列举主要支持政策类型
   - 说明申请条件和流程
   - 提供资金支持标准
   - 给出申请材料清单
   - 提示注意事项
3. 引用具体政策文件
```

**回答要点检查**：
- [ ] 政策类型清晰（如产业扶持、基础设施、人才引进）
- [ ] 申请流程明确
- [ ] 包含联系方式或部门信息
- [ ] 提醒政策时效性
- [ ] 建议咨询相关部门

**追问测试**：
```
用户：产业扶持政策的具体标准是什么？
系统：[应该深入查询政策细节，提供具体标准]
```

---

### 测试用例 8：产业规划咨询

**测试目标**：验证系统提供农业产业发展规划的能力

**测试步骤**：

1. 输入问题：
   ```
   我想在博罗县发展有机农业，有什么建议？
   ```
2. 点击发送
3. 观察系统响应

**预期结果**：

```
✅ 系统处理过程：
1. 工具调用：
   - [工具] search_knowledge：搜索"有机农业"、"认证标准"
   - [工具] get_document_overview：获取相关规划文档
   - [工具] get_chapter_content：提取详细章节
2. 综合回答：
   - 有机农业的市场前景
   - 认证要求和流程
   - 适宜发展的作物品种
   - 技术支持和培训
   - 政策扶持措施
   - 风险提示和应对建议
3. 引用规划文档和政策文件
```

**回答质量标准**：
- [ ] 基于当地实际情况（博罗县）
- [ ] 提供完整的产业链建议
- [ ] 包含认证、技术、市场等多维度
- [ ] 提示风险和挑战
- [ ] 给出分步实施建议

**高级测试**（复杂场景）：
```
用户：我想在博罗县长宁镇发展有机茶园，结合罗浮山旅游，有什么综合建议？
系统：[应该整合农业规划、旅游发展、品牌建设等多方面内容]
```

---

## 🔄 混合场景测试用例

### 测试用例 9：先检测后规划

**测试目标**：验证系统处理"识别+咨询"复合场景的能力

**测试步骤**：

1. 上传一张害虫图片
2. 输入问题：
   ```
   这是害虫吗？如果是，如何防治？另外，我们村想发展生态农业，有什么建议？
   ```
3. 点击发送
4. 观察系统响应

**预期结果**：

```
✅ 系统处理过程：
1. 意图识别：既有图片，又有两个问题（检测+规划）
2. 依次处理：
   步骤1：调用害虫检测工具
   → 识别害虫种类
   → 提供防治方案

   步骤2：调用 RAG 规划工具
   → 查询生态农业发展文档
   → 提供规划建议

3. 综合回复：
   - 首先：害虫识别结果和防治建议
   - 其次：生态农业发展规划
   - 最后：整合建议（如如何结合病虫害防治发展生态农业）
```

**成功标准**：
- [ ] 正确识别两个意图
- [ ] 两个问题都得到完整回答
- [ ] 回答之间有逻辑关联
- [ ] 提供整合性建议

---

### 测试用例 10：多轮对话测试

**测试目标**：验证系统的记忆和上下文理解能力

**对话流程**：

```
第1轮：
用户：博罗县适合发展什么产业？
系统：[基于知识库回答：农业、旅游、制造业等]

第2轮：
用户：刚才提到的旅游业，具体怎么做？
系统：[应该知道"旅游业"指上一轮的内容，深入回答]

第3轮：
用户：那罗浮山景区有什么特色？
系统：[应该结合前两轮的旅游产业讨论，针对性地回答]

第4轮：
用户：给我们村做个详细的旅游规划吧。
系统：[应该综合前三轮的信息，结合知识库给出定制化方案]
```

**预期结果**：
- [ ] 每轮都理解上下文
- [ ] 对话连贯，不割裂
- [ ] 逐步深入，不重复
- [ ] 最终方案整合所有信息

**高级测试**：切换话题
```
第5轮：
用户：对了，我地里发现了虫害。上传图片...
系统：[应该智能切换到检测模式，处理虫害问题]

第6轮：
用户：还是回到旅游规划吧，具体怎么实施？
系统：[应该切换回旅游话题，记住之前的讨论内容]
```

---

## ⚠️ 边界情况和异常测试

### 测试用例 11：无相关图片

**测试步骤**：
1. 上传一张与农业无关的图片（如汽车、建筑）
2. 输入："这是什么？"
3. 观察系统响应

**预期结果**：
```
✅ 系统应该：
- 识别出图片内容
- 提示"该图片不在农业检测范围内"
- 建议上传相关图片
```

---

### 测试用例 12：模糊图片

**测试步骤**：
1. 上传一张模糊、光线昏暗的图片
2. 输入："这是什么害虫？"
3. 观察系统响应

**预期结果**：
```
✅ 系统应该：
- 尝试识别，但置信度较低
- 提示"图片质量不佳，建议重新拍摄"
- 如果能识别，给出结果并说明不确定度
```

---

### 测试用例 13：知识库外问题

**测试步骤**：
1. 输入："量子力学是什么？"
2. 观察系统响应

**预期结果**：
```
✅ 系统应该：
- 提示"该问题超出知识库范围"
- 说明知识库覆盖领域（农业、乡村规划等）
- 建议提问相关问题
- 不应该基于预训练数据编造答案
```

---

### 测试用例 14：空输入

**测试步骤**：
1. 不输入任何内容，直接点击发送
2. 观察系统响应

**预期结果**：
```
✅ 系统应该：
- 提示"请输入问题或上传图片"
- 不应该崩溃或报错
```

---

### 测试用例 15：超长输入

**测试步骤**：
1. 输入一段超长文本（如1000字）
2. 观察系统响应

**预期结果**：
```
✅ 系统应该：
- 正常处理
- 可能提示"问题较长，处理时间稍长"
- 给出有针对性的回答
```

---

## 📊 性能测试

### 测试用例 16：并发测试

**测试目标**：验证系统并发处理能力

**测试步骤**：
1. 打开3个浏览器标签页
2. 同时在不同的标签页进行不同类型的测试
3. 观察系统响应

**预期结果**：
- [ ] 所有请求都能正常处理
- [ ] 响应时间在可接受范围内
- [ ] 不出现请求丢失或混乱

---

### 测试用例 17：长时间稳定性测试

**测试目标**：验证系统长时间运行的稳定性

**测试步骤**：
1. 连续进行50轮对话
2. 每轮包含图片上传或文本提问
3. 观察系统表现

**预期结果**：
- [ ] 系统持续稳定运行
- [ ] 内存占用合理
- [ ] 响应时间无明显增长
- [ ] 不出现崩溃或卡死

---

## ✅ 测试检查清单

### 功能完整性

- [ ] **图像检测**：害虫、大米、牛只三种检测服务都正常
- [ ] **规划咨询**：能回答各类农业和乡村发展问题
- [ ] **智能路由**：能正确判断用户意图
- [ ] **多图片上传**：支持批量上传和预览
- [ ] **流式响应**：实时显示 AI 回复
- [ ] **多轮对话**：保持上下文连贯性

### 回答质量

- [ ] **准确性**：检测结果准确，规划建议合理
- [ ] **专业性**：使用专业术语，提供专业建议
- [ ] **可操作性**：建议具体可执行
- [ ] **引用来源**：规划咨询明确标注信息来源
- [ ] **逻辑清晰**：回答结构清晰，层次分明

### 用户体验

- [ ] **响应速度**：检测 < 5秒，咨询 < 10秒
- [ ] **界面友好**：操作简单直观
- [ ] **错误提示**：异常情况有友好提示
- [ ] **移动端适配**：支持手机浏览器访问

### 技术指标

- [ ] **服务稳定性**：长时间运行不崩溃
- [ ] **并发能力**：支持多用户同时使用
- [ ] **容错能力**：异常输入不导致系统崩溃
- [ ] **扩展性**：易于添加新功能和服务

---

## 🐛 问题报告模板

如果测试中发现问题，请按以下格式记录：

```
### 问题描述

**测试用例**：[测试用例编号和名称]
**测试步骤**：
1. ...
2. ...

**预期结果**：...
**实际结果**：...
**截图/录屏**：[如果有]

**环境信息**：
- 操作系统：
- 浏览器：
- 服务版本：

**复现概率**：[必现/偶尔/难以复现]
```

---

## 📝 测试建议

### 测试顺序建议

1. **先简单后复杂**：从单个功能的简单测试开始
2. **先正常后异常**：先验证正常场景，再测试边界情况
3. **先独立后集成**：先测试各个服务，再测试整体流程

### 测试技巧

1. **多样化输入**：使用不同类型、不同质量的图片
2. **多角度提问**：对同一主题从不同角度提问
3. **深度追问**：通过多轮对话探索系统能力边界
4. **记录问题**：详细记录发现的问题和复现步骤

### 测试反馈

测试完成后，建议反馈：
- 功能改进建议
- 用户体验优化点
- 新功能需求
- Bug 和问题报告

---

**文档版本**：v1.0.0
**最后更新**：2026-01-26
**维护者**：RuralBrain 开发团队
