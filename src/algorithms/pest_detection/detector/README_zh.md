# å®³è™«æ£€æµ‹æœåŠ¡æ¨¡å—

åŸºäº YOLOv8 æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ™ºèƒ½å®³è™«æ£€æµ‹ FastAPI æœåŠ¡ï¼Œæ”¯æŒ 29 ç§å¸¸è§å†œä¸šå®³è™«çš„è¯†åˆ«ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
detector/
â”œâ”€â”€ app/                      # åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ api/                  # APIè·¯ç”±
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ schemas/              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡é€»è¾‘ï¼ˆæ¨¡å‹æœåŠ¡ï¼‰
â”‚   â””â”€â”€ main.py               # FastAPIåº”ç”¨å…¥å£
â”œâ”€â”€ models/                   # æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ best.pt              # YOLOv8è®­ç»ƒçš„æ¨¡å‹
â”‚   â””â”€â”€ classes.txt          # å®³è™«ç±»åˆ«åˆ—è¡¨
â”œâ”€â”€ start_service.py         # æœåŠ¡å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
â””â”€â”€ run.py                   # åŸå§‹å¯åŠ¨è„šæœ¬ï¼ˆä¿ç•™å…¼å®¹ï¼‰
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šDockeréƒ¨ç½²ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

**å‰ææ¡ä»¶**ï¼š
- å·²å®‰è£… Docker Desktop
- Docker æœåŠ¡æ­£åœ¨è¿è¡Œ

**å¯åŠ¨æ­¥éª¤**ï¼š
```bash
# è¿›å…¥ detector ç›®å½•
cd src/algorithms/pest_detection/detector

# æ„å»ºå¹¶å¯åŠ¨æœåŠ¡ï¼ˆé¦–æ¬¡æˆ–ä»£ç æ›´æ–°åï¼‰
docker-compose up -d --build

# ä»…å¯åŠ¨æœåŠ¡ï¼ˆæ— éœ€æ„å»ºï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose stop

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down
```

**ä¿®æ”¹ç«¯å£**ï¼š
ç¼–è¾‘ `docker-compose.yml`ï¼Œä¿®æ”¹ç«¯å£æ˜ å°„ï¼š
```yaml
ports:
  - "8002:8001"  # å°†8001æ”¹ä¸ºå…¶ä»–ç«¯å£
```

### æ–¹å¼äºŒï¼šPythonç›´æ¥è¿è¡Œï¼ˆæ¨èç”¨äºå¼€å‘ç¯å¢ƒï¼‰

ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd D:\sourse code\RuralBrain

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\activate

# å¯åŠ¨æœåŠ¡
python -m src.algorithms.pest_detection.detector.start_service
```

### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œ

```bash
cd src/algorithms/pest_detection/detector
python start_service.py
```

## ğŸŒ è®¿é—®æœåŠ¡

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **APIæ–‡æ¡£**: http://localhost:8001/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8001/health
- **ä¸»é¡µ**: http://localhost:8001

## ğŸ› æ”¯æŒçš„å®³è™«ç±»å‹

å…±æ”¯æŒ 29 ç§å¸¸è§å†œä¸šå®³è™«ï¼š
- ç“œå®è‡ã€å°èœè›¾ã€æ–‘æ½œè‡ã€ä¾§å¤šé£Ÿè·—çº¿è¨
- ç¨»ç²‰è™±ã€è”æè’‚è›€è™«ã€è”æè½ã€è”æç˜¿è¨
- ç”˜è”—èŸè™«ã€èŒ¶å°ç»¿å¶è‰ã€ç¦å¯¿èºã€å°è±¡ç”²
- çƒŸç²‰è™±ã€ç¨»çºµå·å¶èŸã€å¤§èŸã€äºŒåŒ–èŸ
- ç¨»é£è™±ã€ç‰ç±³èŸã€è‰åœ°è´ªå¤œè›¾ã€èšœè™«
- é»„æ›²æ¡è·³ç”²ã€ç”œèœå¤œè›¾ã€è”¬èœè“Ÿé©¬ã€èœé’è™«
- æŸ‘æ¡”çº¢èœ˜è››ã€æŸ‘æ¡”é”ˆèœ˜è››ã€æ¡”å°å®è‡
- æ–œçº¹å¤œè›¾ã€æŸ‘æ¡”æ½œå¶è›¾

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python >= 3.8
- å†…å­˜: è‡³å°‘ 2GB å¯ç”¨
- æ¨¡å‹æ–‡ä»¶: `models/best.pt` (å¿…é¡»å­˜åœ¨)

## ğŸ”§ é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ä½äº `app/core/config.py`ï¼Œæ”¯æŒä»¥ä¸‹é…ç½®ï¼š

- `HOST`: æœåŠ¡å™¨ç›‘å¬åœ°å€ï¼ˆé»˜è®¤: 0.0.0.0ï¼‰
- `PORT`: æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤: 8001ï¼‰
- `MODEL_PATH`: æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰
- `CLASSES_PATH`: ç±»åˆ«æ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰

## ğŸ§ª API ä½¿ç”¨ç¤ºä¾‹

### Python ç¤ºä¾‹

```python
import requests
import base64

# 1. å¥åº·æ£€æŸ¥
response = requests.get("http://localhost:8001/health")
print(response.json())

# 2. æ£€æµ‹å›¾ç‰‡ä¸­çš„å®³è™«
with open("pest_image.jpg", "rb") as f:
    img_b64 = base64.b64encode(f.read()).decode()

response = requests.post(
    "http://localhost:8001/detect",
    json={"image_base64": img_b64}
)

result = response.json()
if result["success"]:
    print(f"æ£€æµ‹åˆ° {len(result['detections'])} ç§å®³è™«:")
    for det in result["detections"]:
        print(f"  - {det['name']}: {det['count']}åª")
```

### curl ç¤ºä¾‹

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8001/health

# æŸ¥çœ‹æ”¯æŒçš„å®³è™«ç±»å‹
curl http://localhost:8001/supported-pests
```

## ğŸ”— ä¸ä¸»é¡¹ç›®é›†æˆ

æœ¬æ¨¡å—å·²é›†æˆåˆ° RuralBrain ä¸»é¡¹ç›®ä¸­ï¼š

1. **Agentå·¥å…·é›†æˆ**: é€šè¿‡ `src/agents/tools/pest_detection_tool.py` è°ƒç”¨
2. **ä¾èµ–ç®¡ç†**: å·²åˆå¹¶åˆ°ä¸»é¡¹ç›® `pyproject.toml`
3. **é…ç½®ç®¡ç†**: ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œæ”¯æŒä»ä»»æ„ä½ç½®å¯åŠ¨

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å·¥ä½œç›®å½•**: å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„å·¥ä½œç›®å½•
2. **æ¨¡å‹æ–‡ä»¶**: ç¡®ä¿ `models/best.pt` æ–‡ä»¶å­˜åœ¨ä¸”å®Œæ•´
3. **ç«¯å£å ç”¨**: é»˜è®¤ä½¿ç”¨ 8001 ç«¯å£ï¼Œå¦‚æœ‰å†²çªè¯·ä¿®æ”¹é…ç½®
4. **å†…å­˜ä½¿ç”¨**: æ¨¡å‹åŠ è½½åçº¦å ç”¨ 200-500MB å†…å­˜

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ä¾èµ–æ˜¯å¦å®Œæ•´å®‰è£…
3. Python ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚
4. ç«¯å£æ˜¯å¦è¢«å ç”¨
